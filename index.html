

<!doctype html>
<html lang="es">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Directorio de Negocios</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #db3717;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .category-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(219, 55, 23, 0.2);
        }
        .business-card {
            transition: all 0.3s ease;
        }
        .business-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .orange-gradient {
            background: linear-gradient(135deg, #db3717 0%, #ff6b47 100%);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="bg-gray-50 min-h-full"><!-- Franja Naranja Superior -->
  <div class="orange-gradient h-16 w-full shadow-lg"></div><!-- Logo de la Empresa -->
  <div class="bg-white py-6 shadow-sm">
   <div class="max-w-6xl mx-auto px-4 text-center">
    <div class="flex items-center justify-center space-x-3">
     <div class="w-12 h-12 rounded-full flex items-center justify-center text-white text-2xl font-bold" style="background-color: #db3717;">
      ğŸ¢
     </div>
     <h1 id="company-name" class="text-3xl font-bold" style="color: #151a2b;">Mi Empresa</h1>
    </div>
    <p id="city-subtitle" class="text-gray-600 mt-2">Directorio de Negocios - Mi Ciudad</p>
   </div>
  </div><!-- Barra de MenÃº con BÃºsqueda -->
  <div class="bg-white border-b-2 py-4 sticky top-0 z-40" style="border-color: #db3717;">
   <div class="max-w-6xl mx-auto px-4">
    <div class="flex flex-col md:flex-row items-center justify-between gap-4"><!-- BÃºsqueda11 -->
     <div class="flex-1 max-w-md">
      <div class="relative"><input type="text" id="search-input" placeholder="ğŸ” Buscar negocios..." class="w-full px-4 py-3 pr-12 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;"> <button id="search-btn" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-white px-3 py-1 rounded" style="background-color: #db3717;"> ğŸ” </button>
      </div>
     </div><!-- Botones de MenÃº -->
     <div class="flex gap-3"><button id="about-btn" class="px-6 py-3 rounded-lg font-medium transition-all hover:opacity-90 text-white" style="background-color: #151a2b;"> ğŸ‘¥ <span id="about-text">QuiÃ©nes Somos</span> </button> <button id="services-btn" class="px-6 py-3 rounded-lg font-medium transition-all hover:opacity-90 text-white" style="background-color: #db3717;"> ğŸ› ï¸ <span id="services-text">Servicios que Prestamos</span> </button> <button id="contract-service-btn" class="px-6 py-3 rounded-lg font-medium transition-all hover:opacity-90 text-white" style="background-color: #db3717;"> ğŸ’¬ Contratar Servicio </button>
     </div>
    </div>
   </div>
  </div>
  <div class="max-w-6xl mx-auto px-4 py-8"><!-- Iconos de CategorÃ­as -->
   <div class="mb-8">
    <h2 class="text-2xl font-bold mb-6 text-center" style="color: #151a2b;">Explora por CategorÃ­as1</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4" id="categories-grid"><!-- CategorÃ­as se generarÃ¡n dinÃ¡micamente -->
    </div>
   </div><!-- Filtros Activos -->
   <div id="active-filters" class="mb-6 hidden">
    <div class="flex flex-wrap items-center gap-2"><span class="text-sm font-medium text-gray-600">Filtros activos:</span>
     <div id="filter-tags" class="flex flex-wrap gap-2"></div><button id="clear-filters" class="text-sm px-3 py-1 rounded-full border-2 hover:bg-gray-50" style="border-color: #db3717; color: #db3717;"> âœ• Limpiar filtros </button>
    </div>
   </div><!-- Contador de Negocios -->
   <div class="mb-6">
    <p id="business-count" class="text-lg font-medium" style="color: #151a2b;">Cargando negocios...</p>
   </div><!-- Grid de Negocios -->
   <div id="business-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Los negocios se mostrarÃ¡n aquÃ­ -->
   </div><!-- Estado VacÃ­o -->
   <div id="empty-state" class="text-center py-16 hidden">
    <div class="text-6xl mb-4">
     ğŸª
    </div>
    <h3 class="text-2xl font-bold mb-2" style="color: #151a2b;">Â¡SÃ© el primero!</h3>
    <p class="text-gray-600 mb-6">No hay negocios publicados aÃºn. Publica el tuyo y comienza a crecer.</p><button id="empty-add-btn" class="px-8 py-3 rounded-lg font-medium text-white transition-all hover:opacity-90" style="background-color: #db3717;"> â• Publicar Primer Negocio </button>
   </div><!-- Sin Resultados -->
   <div id="no-results-state" class="text-center py-16 hidden">
    <div class="text-6xl mb-4">
     ğŸ”
    </div>
    <h3 class="text-2xl font-bold mb-2" style="color: #151a2b;">Sin resultados</h3>
    <p class="text-gray-600">No encontramos negocios que coincidan con tu bÃºsqueda.</p>
   </div>
  </div><!-- Pie de PÃ¡gina Principal -->
  <footer class="bg-white border-t-2 py-6 mt-12" style="border-color: #db3717;">
   <div class="max-w-6xl mx-auto px-4">
    <div class="flex justify-between items-center">
     <p class="text-gray-600">Hecho por Solum</p><button id="admin-btn" class="px-4 py-2 rounded-lg font-medium text-white transition-all hover:opacity-90" style="background-color: #151a2b;"> ğŸ” Administrador </button>
    </div>
   </div>
  </footer><!-- Modal Publicar Negocio -->
  <div id="add-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
   <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-lg w-full max-h-[90vh] overflow-y-auto">
    <div class="flex justify-between items-center mb-6">
     <h2 class="text-2xl font-bold" style="color: #151a2b;">ğŸ“ Publicar Negocio</h2><button id="close-modal" class="text-gray-500 hover:text-gray-700 text-3xl">Ã—</button>
    </div>
    <form id="business-form">
     <div class="space-y-4">
      <div><label for="business-name" class="block text-sm font-medium mb-2" style="color: #151a2b;">Nombre del Negocio *</label> <input type="text" id="business-name" required class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;" placeholder="Ej: Restaurante El Buen Sabor">
      </div>
      <div><label for="business-category" class="block text-sm font-medium mb-2" style="color: #151a2b;">CategorÃ­a *</label> <select id="business-category" required class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;"> <option value="">Seleccionar categorÃ­a</option> </select>
      </div>
      <div><label for="business-description" class="block text-sm font-medium mb-2" style="color: #151a2b;">DescripciÃ³n</label> <textarea id="business-description" rows="3" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;" placeholder="Describe tu negocio..."></textarea>
      </div>
      <div><label for="business-website" class="block text-sm font-medium mb-2" style="color: #151a2b;">Sitio Web</label> <input type="url" id="business-website" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;" placeholder="https://www.minegocio.com">
      </div>
     </div>
     <div class="flex gap-3 mt-8"><button type="button" id="cancel-btn" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 px-4 rounded-lg font-medium transition-colors"> Cancelar </button> <button type="submit" id="submit-btn" class="flex-1 text-white py-3 px-4 rounded-lg font-medium transition-colors" style="background-color: #db3717;"> Publicar Negocio </button>
     </div>
    </form>
   </div>
  </div><!-- Modal InformaciÃ³n -->
  <div id="info-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
   <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-md w-full">
    <div class="flex justify-between items-center mb-4">
     <h2 id="info-modal-title" class="text-xl font-bold" style="color: #151a2b;"></h2><button id="close-info-modal" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
    </div>
    <div id="info-modal-content" class="text-gray-600"><!-- Contenido dinÃ¡mico -->
    </div>
   </div>
  </div><!-- PÃ¡gina de Perfil del Negocio -->
  <div id="business-profile-page" class="fixed inset-0 bg-gray-50 hidden z-50 overflow-y-auto"><!-- Franja Naranja Superior -->
   <div class="orange-gradient h-16 w-full shadow-lg"></div><!-- Logo de la Empresa -->
   <div class="bg-white py-6 shadow-sm">
    <div class="max-w-6xl mx-auto px-4 text-center">
     <div class="flex items-center justify-center space-x-3">
      <div class="w-12 h-12 rounded-full flex items-center justify-center text-white text-2xl font-bold" style="background-color: #db3717;">
       ğŸ¢
      </div>
      <h1 id="profile-company-name" class="text-3xl font-bold" style="color: #151a2b;">Mi Empresa</h1>
     </div>
     <p id="profile-city-subtitle" class="text-gray-600 mt-2">Directorio de Negocios - Mi Ciudad</p>
    </div>
   </div><!-- Barra de MenÃº -->
   <div class="bg-white border-b-2 py-4" style="border-color: #db3717;">
    <div class="max-w-6xl mx-auto px-4">
     <div class="flex items-center justify-between"><button id="back-to-directory" class="flex items-center space-x-2 px-4 py-2 rounded-lg font-medium text-white transition-all hover:opacity-90" style="background-color: #151a2b;"> â† <span>Volver al Directorio</span> </button>
      <div class="flex gap-3"><button class="px-6 py-3 rounded-lg font-medium transition-all hover:opacity-90 text-white" style="background-color: #151a2b;"> ğŸ‘¥ QuiÃ©nes Somos </button> <button class="px-6 py-3 rounded-lg font-medium transition-all hover:opacity-90 text-white" style="background-color: #db3717;"> ğŸ› ï¸ Servicios que Prestamos </button>
      </div>
     </div>
    </div>
   </div><!-- Contenido del Perfil -->
   <div class="max-w-4xl mx-auto px-4 py-8"><!-- InformaciÃ³n Principal del Negocio -->
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
     <div class="flex flex-col md:flex-row gap-8"><!-- Logo y Info BÃ¡sica -->
      <div class="md:w-1/3">
       <div class="w-32 h-32 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center mb-4 text-gray-400 text-sm text-center mx-auto">
        ğŸ“·<br>
        Logo<br>
        Empresa
       </div>
       <div class="text-center">
        <h1 id="profile-business-name" class="text-3xl font-bold mb-2" style="color: #151a2b;"></h1>
        <div id="profile-business-category" class="inline-block px-4 py-2 rounded-full text-white font-medium mb-4" style="background-color: #db3717;"></div>
       </div>
      </div><!-- InformaciÃ³n Detallada -->
      <div class="md:w-2/3">
       <div class="space-y-4">
        <div id="profile-description" class="text-gray-700 text-lg leading-relaxed"></div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
         <div id="profile-website" class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg hidden"><span class="text-2xl">ğŸŒ</span>
          <div>
           <p class="font-medium text-gray-800">Sitio Web</p>
           <p class="text-gray-600" id="profile-website-text"></p>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div><!-- Botones de Redes Sociales -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
     <h2 class="text-2xl font-bold mb-6 text-center" style="color: #151a2b;">Conecta con Nosotros</h2>
     <div class="grid grid-cols-2 md:grid-cols-4 gap-4"><button id="instagram-btn" class="flex flex-col items-center p-4 rounded-lg transition-all hover:scale-105" style="background-color: #E4405F; color: white;"> <span class="text-3xl mb-2">ğŸ“·</span> <span class="font-medium">Instagram</span> </button> <button id="whatsapp-btn" class="flex flex-col items-center p-4 rounded-lg transition-all hover:scale-105" style="background-color: #25D366; color: white;"> <span class="text-3xl mb-2">ğŸ’¬</span> <span class="font-medium">WhatsApp</span> </button> <button id="phone-btn" class="flex flex-col items-center p-4 rounded-lg transition-all hover:scale-105" style="background-color: #db3717; color: white;"> <span class="text-3xl mb-2">ğŸ“</span> <span class="font-medium">Llamar</span> </button> <button id="location-btn" class="flex flex-col items-center p-4 rounded-lg transition-all hover:scale-105" style="background-color: #151a2b; color: white;"> <span class="text-3xl mb-2">ğŸ“</span> <span class="font-medium">UbicaciÃ³n</span> </button>
     </div>
    </div><!-- GalerÃ­a de ImÃ¡genes -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
     <h2 class="text-2xl font-bold mb-6 text-center" style="color: #151a2b;">GalerÃ­a de ImÃ¡genes</h2>
     <div class="relative">
      <div id="image-gallery" class="w-full h-64 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden">
       <div id="gallery-slide" class="w-full h-full flex items-center justify-center text-gray-400 text-6xl transition-all duration-1000">
        ğŸ–¼ï¸
       </div>
      </div>
      <div class="flex justify-center mt-4 space-x-2" id="gallery-dots"><!-- Dots se generarÃ¡n dinÃ¡micamente -->
      </div>
     </div>
    </div>
   </div><!-- Pie de PÃ¡gina -->
   <footer class="bg-white border-t-2 py-8 mt-12" style="border-color: #db3717;">
    <div class="max-w-6xl mx-auto px-4 text-center">
     <p class="text-xl font-bold mb-2" style="color: #151a2b;">LocalÃ­zate MÃ©rida</p>
     <p class="text-gray-600">Hecho por Solum</p>
    </div>
   </footer>
  </div><!-- Modal de Login Administrador -->
  <div id="admin-login-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
   <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-md w-full">
    <div class="flex justify-between items-center mb-6">
     <h2 class="text-2xl font-bold" style="color: #151a2b;">ğŸ” Acceso Administrador</h2><button id="close-admin-login" class="text-gray-500 hover:text-gray-700 text-3xl">Ã—</button>
    </div>
    <form id="admin-login-form">
     <div class="mb-4"><label for="admin-password" class="block text-sm font-medium mb-2" style="color: #151a2b;">ContraseÃ±a de Administrador</label> <input type="password" id="admin-password" required class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;" placeholder="Ingrese la contraseÃ±a">
     </div>
     <div class="flex gap-3"><button type="button" id="cancel-admin-login" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 px-4 rounded-lg font-medium transition-colors"> Cancelar </button> <button type="submit" class="flex-1 text-white py-3 px-4 rounded-lg font-medium transition-colors" style="background-color: #db3717;"> Ingresar </button>
     </div>
    </form>
   </div>
  </div><!-- PÃ¡gina de Administrador -->
  <div id="admin-page" class="fixed inset-0 bg-gray-50 hidden z-50 overflow-y-auto"><!-- Franja Naranja Superior -->
   <div class="orange-gradient h-16 w-full shadow-lg"></div><!-- Logo de la Empresa -->
   <div class="bg-white py-6 shadow-sm">
    <div class="max-w-6xl mx-auto px-4 text-center">
     <div class="flex items-center justify-center space-x-3">
      <div class="w-12 h-12 rounded-full flex items-center justify-center text-white text-2xl font-bold" style="background-color: #db3717;">
       ğŸ¢
      </div>
      <h1 class="text-3xl font-bold" style="color: #151a2b;">Panel de Administrador</h1>
     </div>
     <p class="text-gray-600 mt-2">GestiÃ³n del Directorio de Negocios</p>
    </div>
   </div><!-- Barra de MenÃº Admin -->
   <div class="bg-white border-b-2 py-4" style="border-color: #db3717;">
    <div class="max-w-6xl mx-auto px-4">
     <div class="flex items-center justify-between"><button id="back-to-main" class="flex items-center space-x-2 px-4 py-2 rounded-lg font-medium text-white transition-all hover:opacity-90" style="background-color: #151a2b;"> â† <span>Volver al Directorio</span> </button> <button id="logout-admin" class="px-4 py-2 rounded-lg font-medium text-white transition-all hover:opacity-90" style="background-color: #db3717;"> ğŸšª Cerrar SesiÃ³n </button>
     </div>
    </div>
   </div><!-- Contenido del Panel Admin -->
   <div class="max-w-6xl mx-auto px-4 py-8"><!-- GestiÃ³n de Negocios -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
     <h2 class="text-2xl font-bold mb-6" style="color: #151a2b;">ğŸ“‹ GestiÃ³n de Negocios</h2>
     <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><button id="admin-add-business" class="p-4 rounded-lg border-2 border-dashed hover:bg-gray-50 transition-colors" style="border-color: #db3717; color: #db3717;">
       <div class="text-3xl mb-2">
        â•
       </div>
       <div class="font-medium">
        Publicar Negocio
       </div></button> <button id="manage-businesses" class="p-4 rounded-lg border-2 border-dashed hover:bg-gray-50 transition-colors" style="border-color: #151a2b; color: #151a2b;">
       <div class="text-3xl mb-2">
        ğŸ“Š
       </div>
       <div class="font-medium">
        Gestionar Negocios
       </div></button>
     </div>
    </div><!-- GestiÃ³n de CategorÃ­as -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
     <h2 class="text-2xl font-bold mb-6" style="color: #151a2b;">ğŸ·ï¸ GestiÃ³n de CategorÃ­as</h2><button id="manage-categories" class="w-full p-4 rounded-lg border-2 border-dashed hover:bg-gray-50 transition-colors" style="border-color: #db3717; color: #db3717;">
      <div class="text-3xl mb-2">
       ğŸ·ï¸
      </div>
      <div class="font-medium">
       Modificar CategorÃ­as
      </div></button>
    </div><!-- GestiÃ³n de Contenido -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
     <h2 class="text-2xl font-bold mb-6" style="color: #151a2b;">ğŸ“ GestiÃ³n de Contenido</h2>
     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><button id="edit-company-info" class="p-4 rounded-lg border-2 border-dashed hover:bg-gray-50 transition-colors" style="border-color: #db3717; color: #db3717;">
       <div class="text-3xl mb-2">
        ğŸ¢
       </div>
       <div class="font-medium">
        InformaciÃ³n de Empresa
       </div></button> <button id="edit-about-content" class="p-4 rounded-lg border-2 border-dashed hover:bg-gray-50 transition-colors" style="border-color: #151a2b; color: #151a2b;">
       <div class="text-3xl mb-2">
        ğŸ‘¥
       </div>
       <div class="font-medium">
        QuiÃ©nes Somos
       </div></button> <button id="edit-services-content" class="p-4 rounded-lg border-2 border-dashed hover:bg-gray-50 transition-colors" style="border-color: #db3717; color: #db3717;">
       <div class="text-3xl mb-2">
        ğŸ› ï¸
       </div>
       <div class="font-medium">
        Servicios que Prestamos
       </div></button>
     </div>
    </div><!-- EstadÃ­sticas -->
    <div class="bg-white rounded-lg shadow-lg p-6">
     <h2 class="text-2xl font-bold mb-6" style="color: #151a2b;">ğŸ“Š EstadÃ­sticas</h2>
     <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="text-center p-4 rounded-lg" style="background-color: #f8f9fa;">
       <div class="text-3xl font-bold mb-2" style="color: #db3717;" id="total-businesses">
        0
       </div>
       <div class="text-gray-600">
        Total de Negocios
       </div>
      </div>
      <div class="text-center p-4 rounded-lg" style="background-color: #f8f9fa;">
       <div class="text-3xl font-bold mb-2" style="color: #151a2b;" id="total-categories">
        14
       </div>
       <div class="text-gray-600">
        CategorÃ­as Disponibles
       </div>
      </div>
      <div class="text-center p-4 rounded-lg" style="background-color: #f8f9fa;">
       <div class="text-3xl font-bold mb-2" style="color: #db3717;" id="recent-businesses">
        0
       </div>
       <div class="text-gray-600">
        Negocios Recientes
       </div>
      </div>
     </div>
    </div>
   </div>
  </div><!-- Modal Editar Contenido -->
  <div id="edit-content-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
   <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-lg w-full max-h-[90vh] overflow-y-auto">
    <div class="flex justify-between items-center mb-6">
     <h2 id="edit-content-title" class="text-2xl font-bold" style="color: #151a2b;">Editar Contenido</h2><button id="close-edit-content" class="text-gray-500 hover:text-gray-700 text-3xl">Ã—</button>
    </div>
    <form id="edit-content-form">
     <div id="edit-content-fields" class="space-y-4"><!-- Campos dinÃ¡micos -->
     </div>
     <div class="flex gap-3 mt-8"><button type="button" id="cancel-edit-content" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 px-4 rounded-lg font-medium transition-colors"> Cancelar </button> <button type="submit" class="flex-1 text-white py-3 px-4 rounded-lg font-medium transition-colors" style="background-color: #db3717;"> Guardar Cambios </button>
     </div>
    </form>
   </div>
  </div><!-- Modal GestiÃ³n de Negocios -->
  <div id="business-manager-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
   <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-6xl w-full max-h-[90vh] overflow-y-auto">
    <div class="flex justify-between items-center mb-6">
     <h2 class="text-2xl font-bold" style="color: #151a2b;">ğŸ“Š GestiÃ³n de Negocios</h2><button id="close-business-manager" class="text-gray-500 hover:text-gray-700 text-3xl">Ã—</button>
    </div>
    <div class="mb-6">
     <p class="text-gray-600">Selecciona un negocio para editarlo completamente</p>
    </div><!-- Lista de Negocios -->
    <div id="admin-businesses-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><!-- Los negocios se mostrarÃ¡n aquÃ­ -->
    </div>
    <div class="flex justify-end mt-6"><button id="close-business-manager-btn" class="px-6 py-3 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg font-medium transition-colors"> Cerrar </button>
    </div>
   </div>
  </div><!-- Modal Editor de Negocio -->
  <div id="business-editor-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
   <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
    <div class="flex justify-between items-center mb-6">
     <h2 id="business-editor-title" class="text-2xl font-bold" style="color: #151a2b;">âœï¸ Editor de Negocio</h2><button id="close-business-editor" class="text-gray-500 hover:text-gray-700 text-3xl">Ã—</button>
    </div><!-- InformaciÃ³n BÃ¡sica -->
    <div class="bg-gray-50 rounded-lg p-6 mb-6">
     <h3 class="text-lg font-bold mb-4" style="color: #151a2b;">ğŸ“ InformaciÃ³n BÃ¡sica</h3>
     <form id="edit-business-form">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label class="block text-sm font-medium mb-2" style="color: #151a2b;">Nombre del Negocio</label> <input type="text" id="edit-business-name" required class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;">
       </div>
       <div><label class="block text-sm font-medium mb-2" style="color: #151a2b;">CategorÃ­a</label> <select id="edit-business-category" required class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;"> <option value="">Seleccionar categorÃ­a</option> </select>
       </div>
       <div class="md:col-span-2"><label class="block text-sm font-medium mb-2" style="color: #151a2b;">DescripciÃ³n</label> <textarea id="edit-business-description" rows="3" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;"></textarea>
       </div>
       <div class="md:col-span-2"><label class="block text-sm font-medium mb-2" style="color: #151a2b;">Sitio Web</label> <input type="url" id="edit-business-website" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;">
       </div>
      </div>
      <div class="flex justify-end mt-4"><button type="submit" class="px-6 py-3 rounded-lg font-medium text-white transition-all hover:opacity-90" style="background-color: #db3717;"> ğŸ’¾ Guardar Cambios </button>
      </div>
     </form>
    </div><!-- GestiÃ³n de Logo -->
    <div class="bg-gray-50 rounded-lg p-6 mb-6">
     <h3 class="text-lg font-bold mb-4" style="color: #151a2b;">ğŸ–¼ï¸ Logo del Negocio</h3>
     <div class="flex items-center space-x-6">
      <div class="w-24 h-24 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-gray-400 text-xs text-center">
       ğŸ“·<br>
       Logo<br>
       Actual
      </div>
      <div class="flex-1">
       <div class="flex gap-3"><button onclick="uploadLogo()" class="px-4 py-2 rounded-lg font-medium text-white transition-all hover:opacity-90" style="background-color: #db3717;"> ğŸ“¤ Subir Logo </button> <button onclick="removeLogo()" class="px-4 py-2 rounded-lg font-medium bg-gray-500 text-white transition-all hover:opacity-90"> ğŸ—‘ï¸ Quitar Logo </button>
       </div>
       <p class="text-sm text-gray-600 mt-2">Formatos: JPG, PNG. TamaÃ±o mÃ¡ximo: 2MB</p>
      </div>
     </div>
    </div><!-- GalerÃ­a de Fotos -->
    <div class="bg-gray-50 rounded-lg p-6 mb-6">
     <h3 class="text-lg font-bold mb-4" style="color: #151a2b;">ğŸ“¸ GalerÃ­a de Fotos</h3>
     <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4" id="business-photos-grid"><!-- Las fotos se mostrarÃ¡n aquÃ­ -->
     </div><button onclick="addPhoto()" class="w-full py-3 px-4 border-2 border-dashed rounded-lg font-medium transition-all hover:bg-gray-50" style="border-color: #db3717; color: #db3717;"> â• Agregar Foto </button>
    </div><!-- InformaciÃ³n de Contacto -->
    <div class="bg-gray-50 rounded-lg p-6 mb-6">
     <h3 class="text-lg font-bold mb-4" style="color: #151a2b;">ğŸ“ InformaciÃ³n de Contacto</h3>
     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div><label class="block text-sm font-medium mb-2" style="color: #151a2b;">TelÃ©fono</label> <input type="tel" id="edit-business-phone" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;" placeholder="Ej: +52 999 123 4567">
      </div>
      <div><label class="block text-sm font-medium mb-2" style="color: #151a2b;">WhatsApp</label> <input type="tel" id="edit-business-whatsapp" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;" placeholder="Ej: +52 999 123 4567">
      </div>
      <div><label class="block text-sm font-medium mb-2" style="color: #151a2b;">Email</label> <input type="email" id="edit-business-email" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;" placeholder="contacto@negocio.com">
      </div>
      <div><label class="block text-sm font-medium mb-2" style="color: #151a2b;">Instagram</label> <input type="text" id="edit-business-instagram" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;" placeholder="@mi_negocio">
      </div>
      <div class="md:col-span-2"><label class="block text-sm font-medium mb-2" style="color: #151a2b;">DirecciÃ³n Completa</label> <textarea id="edit-business-address" rows="2" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;" placeholder="Calle, nÃºmero, colonia, ciudad, cÃ³digo postal"></textarea>
      </div>
     </div>
     <div class="flex justify-end mt-4"><button id="save-contact-btn" onclick="handleSaveContact()" class="px-6 py-3 rounded-lg font-medium text-white transition-all hover:opacity-90" style="background-color: #db3717;"> ğŸ’¾ Guardar InformaciÃ³n de Contacto </button>
     </div>
    </div><!-- Zona de Peligro -->
    <div class="bg-red-50 border-2 border-red-200 rounded-lg p-6">
     <h3 class="text-lg font-bold mb-4 text-red-700">âš ï¸ Zona de Peligro</h3>
     <p class="text-red-600 mb-4">Esta acciÃ³n no se puede deshacer. El negocio serÃ¡ eliminado permanentemente.</p><button id="delete-business-btn" onclick="handleDeleteBusiness()" class="px-6 py-3 rounded-lg font-medium text-white transition-all hover:opacity-90" style="background-color: #dc2626;"> ğŸ—‘ï¸ Eliminar Negocio </button>
    </div>
   </div>
  </div><!-- Modal GestiÃ³n de CategorÃ­as -->
  <div id="category-manager-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
   <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
    <div class="flex justify-between items-center mb-6">
     <h2 class="text-2xl font-bold" style="color: #151a2b;">ğŸ·ï¸ GestiÃ³n de CategorÃ­as</h2><button id="close-category-manager" class="text-gray-500 hover:text-gray-700 text-3xl">Ã—</button>
    </div><!-- Agregar Nueva CategorÃ­a -->
    <div class="bg-gray-50 rounded-lg p-4 mb-6">
     <h3 class="text-lg font-bold mb-4" style="color: #151a2b;">â• Agregar Nueva CategorÃ­a</h3>
     <form id="add-category-form">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
       <div><label class="block text-sm font-medium mb-2" style="color: #151a2b;">Nombre</label> <input type="text" id="new-category-name" required class="w-full px-3 py-2 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;" placeholder="Ej: Farmacia">
       </div>
       <div><label class="block text-sm font-medium mb-2" style="color: #151a2b;">Icono (Emoji)</label> <input type="text" id="new-category-icon" required class="w-full px-3 py-2 border-2 rounded-lg focus:outline-none focus:ring-2" style="border-color: #db3717; --tw-ring-color: #db3717;" placeholder="ğŸ’Š" maxlength="2">
       </div>
       <div class="flex items-end"><button type="submit" class="w-full py-2 px-4 rounded-lg font-medium text-white transition-all hover:opacity-90" style="background-color: #db3717;"> Agregar </button>
       </div>
      </div>
     </form>
    </div><!-- Lista de CategorÃ­as Existentes -->
    <div>
     <h3 class="text-lg font-bold mb-4" style="color: #151a2b;">ğŸ“‹ CategorÃ­as Existentes</h3>
     <div id="categories-list" class="space-y-2 max-h-96 overflow-y-auto"><!-- CategorÃ­as se generarÃ¡n dinÃ¡micamente -->
     </div>
    </div>
    <div class="flex justify-end mt-6"><button id="close-category-manager-btn" class="px-6 py-3 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg font-medium transition-colors"> Cerrar </button>
    </div>
   </div>
  </div>
  <script>
        // ConfiguraciÃ³n
        const defaultConfig = {
            company_name: "Mi Empresa",
            city_name: "Mi Ciudad",
            about_text: "QuiÃ©nes Somos",
            services_text: "Servicios que Prestamos",
            primary_color: "#151a2b",
            secondary_color: "#db3717"
        };

        // CategorÃ­as de negocios
        let categories = [
            { name: "Hoteles", icon: "ğŸ¨", color: "#db3717" },
            { name: "Restaurantes", icon: "ğŸ½ï¸", color: "#151a2b" },
            { name: "HeladerÃ­as", icon: "ğŸ¦", color: "#db3717" },
            { name: "Tiendas", icon: "ğŸ›ï¸", color: "#151a2b" },
            { name: "Servicios", icon: "ğŸ”§", color: "#db3717" },
            { name: "Salud", icon: "ğŸ¥", color: "#151a2b" },
            { name: "EducaciÃ³n", icon: "ğŸ“š", color: "#db3717" },
            { name: "Entretenimiento", icon: "ğŸ­", color: "#151a2b" },
            { name: "Transporte", icon: "ğŸš—", color: "#db3717" },
            { name: "Belleza", icon: "ğŸ’„", color: "#151a2b" },
            { name: "Deportes", icon: "âš½", color: "#db3717" },
            { name: "TecnologÃ­a", icon: "ğŸ’»", color: "#151a2b" },
            { name: "HolÃ­stico", icon: "ğŸ§˜", color: "#db3717" },
            { name: "Ropa y Calzado", icon: "ğŸ‘•", color: "#151a2b" }
        ];

        // Variables globales
        let allBusinesses = [];
        let filteredBusinesses = [];
        let activeFilters = {
            search: '',
            category: ''
        };
        let currentBusiness = null;
        let galleryInterval = null;
        let currentSlide = 0;

        // Handler para Data SDK
        const dataHandler = {
            onDataChanged(data) {
                allBusinesses = data;
                applyFilters();
                updateBusinessCount();
            }
        };

        // InicializaciÃ³n
        async function initializeApp() {
            // Inicializar Data SDK
            const initResult = await window.dataSdk.init(dataHandler);
            if (!initResult.isOk) {
                console.error("Error al inicializar Data SDK");
                return;
            }

            // Inicializar Element SDK
            if (window.elementSdk) {
                window.elementSdk.init({
                    defaultConfig,
                    render: async (config) => {
                        document.getElementById('company-name').textContent = config.company_name || defaultConfig.company_name;
                        document.getElementById('city-subtitle').textContent = `Directorio de Negocios - ${config.city_name || defaultConfig.city_name}`;
                        document.getElementById('about-text').textContent = config.about_text || defaultConfig.about_text;
                        document.getElementById('services-text').textContent = config.services_text || defaultConfig.services_text;
                    },
                    mapToCapabilities: (config) => ({
                        recolorables: [
                            {
                                get: () => config.primary_color || defaultConfig.primary_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.setConfig({ primary_color: value });
                                    }
                                }
                            },
                            {
                                get: () => config.secondary_color || defaultConfig.secondary_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.setConfig({ secondary_color: value });
                                    }
                                }
                            }
                        ],
                        borderables: [],
                        fontEditable: undefined,
                        fontSizeable: undefined
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["company_name", config.company_name || defaultConfig.company_name],
                        ["city_name", config.city_name || defaultConfig.city_name],
                        ["about_text", config.about_text || defaultConfig.about_text],
                        ["services_text", config.services_text || defaultConfig.services_text]
                    ])
                });
            }

            renderCategories();
            populateCategorySelect();
            setupEventListeners();
        }

        // Renderizar categorÃ­as
        function renderCategories() {
            const grid = document.getElementById('categories-grid');
            grid.innerHTML = categories.map((category, index) => `
                <div class="category-card bg-white rounded-lg p-4 text-center shadow-md border-2 border-transparent hover:border-current" 
                     style="color: ${category.color};" 
                     onclick="filterByCategory('${category.name}')">
                    <div class="text-3xl mb-2">${category.icon}</div>
                    <h3 class="font-semibold text-sm">${category.name}</h3>
                </div>
            `).join('');
        }

        // Poblar select de categorÃ­as
        function populateCategorySelect() {
            const select = document.getElementById('business-category');
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.name;
                option.textContent = `${category.icon} ${category.name}`;
                select.appendChild(option);
            });
        }

        // Event Listeners
        function setupEventListeners() {
            // BÃºsqueda
            document.getElementById('search-input').addEventListener('input', handleSearch);
            document.getElementById('search-btn').addEventListener('click', handleSearch);

            // Botones de menÃº
            document.getElementById('about-btn').addEventListener('click', () => showInfoModal('QuiÃ©nes Somos', 'Somos una empresa dedicada a conectar negocios locales con la comunidad. Nuestro objetivo es promover el comercio local y facilitar que las personas descubran los mejores servicios de su ciudad.'));
            document.getElementById('services-btn').addEventListener('click', () => showInfoModal('Nuestros Servicios', 'Ofrecemos una plataforma completa para que los negocios locales puedan: â€¢ Publicar su informaciÃ³n de contacto â€¢ Mostrar sus servicios y productos â€¢ Conectar con clientes potenciales â€¢ Aumentar su visibilidad en la comunidad'));

            // BotÃ³n contratar servicio
            document.getElementById('contract-service-btn').addEventListener('click', () => {
                const message = encodeURIComponent('Hola! Me interesa contratar sus servicios para publicar mi negocio en el directorio.');
                window.open(`https://wa.me/19752224?text=${message}`, '_blank', 'noopener,noreferrer');
            });

            // Modales
            document.getElementById('empty-add-btn').addEventListener('click', openAddModal);
            document.getElementById('close-modal').addEventListener('click', closeAddModal);
            document.getElementById('cancel-btn').addEventListener('click', closeAddModal);
            document.getElementById('close-info-modal').addEventListener('click', closeInfoModal);

            // Formulario
            document.getElementById('business-form').addEventListener('submit', handleFormSubmit);

            // Filtros
            document.getElementById('clear-filters').addEventListener('click', clearAllFilters);

            // Perfil de negocio
            document.getElementById('back-to-directory').addEventListener('click', closeBusinessProfile);

            // Botones de redes sociales
            document.getElementById('instagram-btn').addEventListener('click', () => openSocialMedia('instagram'));
            document.getElementById('whatsapp-btn').addEventListener('click', () => openSocialMedia('whatsapp'));
            document.getElementById('phone-btn').addEventListener('click', () => openSocialMedia('phone'));
            document.getElementById('location-btn').addEventListener('click', () => openSocialMedia('location'));

            // Panel de administrador
            document.getElementById('admin-btn').addEventListener('click', openAdminLogin);
            document.getElementById('close-admin-login').addEventListener('click', closeAdminLogin);
            document.getElementById('cancel-admin-login').addEventListener('click', closeAdminLogin);
            document.getElementById('admin-login-form').addEventListener('submit', handleAdminLogin);
            document.getElementById('back-to-main').addEventListener('click', closeAdminPanel);
            document.getElementById('logout-admin').addEventListener('click', closeAdminPanel);
            document.getElementById('admin-add-business').addEventListener('click', () => {
                closeAdminPanel();
                openAddModal();
            });
            document.getElementById('edit-company-info').addEventListener('click', () => openEditContent('company'));
            document.getElementById('edit-about-content').addEventListener('click', () => openEditContent('about'));
            document.getElementById('edit-services-content').addEventListener('click', () => openEditContent('services'));
            document.getElementById('manage-categories').addEventListener('click', openCategoryManager);
            document.getElementById('manage-businesses').addEventListener('click', openBusinessManager);
            document.getElementById('close-edit-content').addEventListener('click', closeEditContent);
            document.getElementById('cancel-edit-content').addEventListener('click', closeEditContent);
            document.getElementById('edit-content-form').addEventListener('submit', handleEditContent);
            document.getElementById('close-business-manager').addEventListener('click', closeBusinessManager);
            document.getElementById('close-business-manager-btn').addEventListener('click', closeBusinessManager);
            document.getElementById('close-business-editor').addEventListener('click', closeBusinessEditor);
            document.getElementById('edit-business-form').addEventListener('submit', handleEditBusiness);

            // GestiÃ³n de categorÃ­as
            document.getElementById('close-category-manager').addEventListener('click', closeCategoryManager);
            document.getElementById('close-category-manager-btn').addEventListener('click', closeCategoryManager);
            document.getElementById('add-category-form').addEventListener('submit', handleAddCategory);

            // Cerrar modales al hacer clic fuera
            document.getElementById('add-modal').addEventListener('click', (e) => {
                if (e.target.id === 'add-modal') closeAddModal();
            });
            document.getElementById('info-modal').addEventListener('click', (e) => {
                if (e.target.id === 'info-modal') closeInfoModal();
            });
            document.getElementById('category-manager-modal').addEventListener('click', (e) => {
                if (e.target.id === 'category-manager-modal') closeCategoryManager();
            });
        }

        // Funciones de bÃºsqueda y filtros
        function handleSearch() {
            activeFilters.search = document.getElementById('search-input').value.toLowerCase().trim();
            applyFilters();
            updateActiveFilters();
        }

        function filterByCategory(categoryName) {
            activeFilters.category = activeFilters.category === categoryName ? '' : categoryName;
            applyFilters();
            updateActiveFilters();
        }

        function applyFilters() {
            filteredBusinesses = allBusinesses.filter(business => {
                const matchesSearch = !activeFilters.search || 
                    business.nombre.toLowerCase().includes(activeFilters.search) ||
                    business.descripcion.toLowerCase().includes(activeFilters.search) ||
                    business.categoria.toLowerCase().includes(activeFilters.search);
                
                const matchesCategory = !activeFilters.category || business.categoria === activeFilters.category;
                
                return matchesSearch && matchesCategory;
            });

            renderBusinesses();
        }

        function updateActiveFilters() {
            const activeFiltersDiv = document.getElementById('active-filters');
            const filterTags = document.getElementById('filter-tags');
            
            const hasFilters = activeFilters.search || activeFilters.category;
            
            if (hasFilters) {
                activeFiltersDiv.classList.remove('hidden');
                let tags = [];
                
                if (activeFilters.search) {
                    tags.push(`<span class="px-3 py-1 rounded-full text-sm text-white" style="background-color: #151a2b;">ğŸ” "${activeFilters.search}"</span>`);
                }
                
                if (activeFilters.category) {
                    const category = categories.find(c => c.name === activeFilters.category);
                    tags.push(`<span class="px-3 py-1 rounded-full text-sm text-white" style="background-color: #db3717;">${category.icon} ${category.name}</span>`);
                }
                
                filterTags.innerHTML = tags.join('');
            } else {
                activeFiltersDiv.classList.add('hidden');
            }
        }

        function clearAllFilters() {
            activeFilters.search = '';
            activeFilters.category = '';
            document.getElementById('search-input').value = '';
            applyFilters();
            updateActiveFilters();
        }

        // Renderizar negocios
        function renderBusinesses() {
            const grid = document.getElementById('business-grid');
            const emptyState = document.getElementById('empty-state');
            const noResultsState = document.getElementById('no-results-state');

            if (allBusinesses.length === 0) {
                grid.innerHTML = '';
                emptyState.classList.remove('hidden');
                noResultsState.classList.add('hidden');
                return;
            }

            if (filteredBusinesses.length === 0) {
                grid.innerHTML = '';
                emptyState.classList.add('hidden');
                noResultsState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            noResultsState.classList.add('hidden');

            grid.innerHTML = filteredBusinesses.map(business => {
                const category = categories.find(c => c.name === business.categoria);
                return `
                    <div class="business-card bg-white rounded-lg shadow-md p-6 border-l-4" style="border-color: ${category ? category.color : '#db3717'};">
                        <div class="mb-4">
                            <!-- Espacio para logo de la empresa -->
                            <div class="w-16 h-16 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center mb-3 text-gray-400 text-xs text-center">
                                ğŸ“·<br>Logo
                            </div>
                            <h3 class="text-xl font-bold" style="color: #151a2b;">${escapeHtml(business.nombre)}</h3>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex items-center space-x-2">
                                <span class="text-2xl">${category ? category.icon : 'ğŸ“‹'}</span>
                                <span class="px-3 py-1 rounded-full text-sm text-white font-medium" style="background-color: ${category ? category.color : '#db3717'};">
                                    ${escapeHtml(business.categoria)}
                                </span>
                            </div>
                            
                            ${business.descripcion ? `<p class="text-gray-600">${escapeHtml(business.descripcion)}</p>` : ''}
                            
                            <div class="space-y-2 text-sm text-gray-600">
                                ${business.sitioWeb ? `
                                    <p class="flex items-center space-x-2">
                                        <span>ğŸŒ</span>
                                        <a href="${escapeHtml(business.sitioWeb)}" target="_blank" rel="noopener noreferrer" class="hover:underline" style="color: #db3717;">
                                            Visitar sitio web
                                        </a>
                                    </p>
                                ` : ''}
                            </div>
                            
                            <!-- BotÃ³n Ver Perfil Completo -->
                            <div class="mt-4 pt-4 border-t border-gray-200">
                                <button onclick="viewBusinessProfile('${business.__backendId}')" 
                                        class="w-full py-2 px-4 rounded-lg font-medium text-white transition-all hover:opacity-90" 
                                        style="background-color: #db3717;">
                                    ğŸ‘ï¸ Ver Perfil Completo
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Funciones de modal
        function openAddModal() {
            document.getElementById('add-modal').classList.remove('hidden');
            document.getElementById('add-modal').classList.add('flex');
            document.getElementById('business-form').reset();
        }

        function closeAddModal() {
            document.getElementById('add-modal').classList.add('hidden');
            document.getElementById('add-modal').classList.remove('flex');
        }

        function showInfoModal(title, content) {
            document.getElementById('info-modal-title').textContent = title;
            document.getElementById('info-modal-content').innerHTML = content.replace(/â€¢/g, '<br>â€¢');
            document.getElementById('info-modal').classList.remove('hidden');
            document.getElementById('info-modal').classList.add('flex');
        }

        function closeInfoModal() {
            document.getElementById('info-modal').classList.add('hidden');
            document.getElementById('info-modal').classList.remove('flex');
        }

        // Manejo de formulario
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            if (allBusinesses.length >= 999) {
                showToast('âŒ LÃ­mite mÃ¡ximo de 999 negocios alcanzado', 'error');
                return;
            }

            const submitBtn = document.getElementById('submit-btn');
            const originalText = submitBtn.textContent;
            submitBtn.innerHTML = '<div class="loading-spinner mx-auto"></div>';
            submitBtn.disabled = true;

            const businessData = {
                id: generateId(),
                nombre: document.getElementById('business-name').value.trim(),
                categoria: document.getElementById('business-category').value,
                descripcion: document.getElementById('business-description').value.trim(),
                direccion: '',
                telefono: '',
                email: '',
                sitioWeb: document.getElementById('business-website').value.trim(),
                fechaCreacion: new Date().toISOString()
            };

            const result = await window.dataSdk.create(businessData);
            
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;

            if (result.isOk) {
                closeAddModal();
                showToast('âœ… Negocio publicado exitosamente', 'success');
            } else {
                showToast('âŒ Error al publicar el negocio', 'error');
            }
        }

        // Funciones auxiliares
        function updateBusinessCount() {
            const count = allBusinesses.length;
            const countElement = document.getElementById('business-count');
            if (count === 0) {
                countElement.textContent = 'No hay negocios publicados';
            } else if (count === 1) {
                countElement.textContent = '1 negocio publicado';
            } else {
                countElement.textContent = `${count} negocios publicados`;
            }
        }

        function generateId() {
            return Date.now().toString() + Math.random().toString(36).substr(2, 9);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 ${
                type === 'success' ? 'bg-green-600' : 
                type === 'error' ? 'bg-red-600' : 'bg-blue-600'
            }`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 4000);
        }

        // Funciones de perfil de negocio
        function viewBusinessProfile(businessId) {
            const business = allBusinesses.find(b => b.__backendId === businessId);
            if (!business) return;

            currentBusiness = business;
            
            // Actualizar informaciÃ³n del perfil
            const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
            document.getElementById('profile-company-name').textContent = config.company_name || defaultConfig.company_name;
            document.getElementById('profile-city-subtitle').textContent = `Directorio de Negocios - ${config.city_name || defaultConfig.city_name}`;
            
            document.getElementById('profile-business-name').textContent = business.nombre;
            
            const category = categories.find(c => c.name === business.categoria);
            const categoryElement = document.getElementById('profile-business-category');
            categoryElement.textContent = `${category ? category.icon : 'ğŸ“‹'} ${business.categoria}`;
            categoryElement.style.backgroundColor = category ? category.color : '#db3717';
            
            document.getElementById('profile-description').textContent = business.descripcion || 'Sin descripciÃ³n disponible.';
            
            // Mostrar/ocultar informaciÃ³n opcional
            const websiteElement = document.getElementById('profile-website');
            
            if (business.sitioWeb) {
                websiteElement.classList.remove('hidden');
                document.getElementById('profile-website-text').textContent = business.sitioWeb;
            } else {
                websiteElement.classList.add('hidden');
            }
            
            // Mostrar pÃ¡gina de perfil
            document.getElementById('business-profile-page').classList.remove('hidden');
            
            // Iniciar galerÃ­a de imÃ¡genes
            startImageGallery();
        }

        function closeBusinessProfile() {
            document.getElementById('business-profile-page').classList.add('hidden');
            currentBusiness = null;
            stopImageGallery();
        }

        function openSocialMedia(platform) {
            if (!currentBusiness) return;
            
            switch (platform) {
                case 'instagram':
                    showToast('ğŸ”— Abriendo Instagram...', 'info');
                    break;
                case 'whatsapp':
                    const message = encodeURIComponent(`Hola! Vi tu negocio "${currentBusiness.nombre}" en el directorio de LocalÃ­zate MÃ©rida.`);
                    window.open(`https://wa.me/19752224?text=${message}`, '_blank', 'noopener,noreferrer');
                    break;
                case 'phone':
                    showToast('ğŸ“ FunciÃ³n de llamada no disponible', 'info');
                    break;
                case 'location':
                    showToast('ğŸ“ FunciÃ³n de ubicaciÃ³n no disponible', 'info');
                    break;
            }
        }

        function startImageGallery() {
            // ImÃ¡genes de ejemplo para la galerÃ­a
            const galleryImages = [
                { emoji: 'ğŸª', text: 'Fachada del Local' },
                { emoji: 'ğŸ›ï¸', text: 'Productos y Servicios' },
                { emoji: 'ğŸ‘¥', text: 'Nuestro Equipo' },
                { emoji: 'ğŸ¯', text: 'Ambiente Interior' },
                { emoji: 'â­', text: 'Experiencia Cliente' }
            ];
            
            currentSlide = 0;
            
            // Crear dots para la galerÃ­a
            const dotsContainer = document.getElementById('gallery-dots');
            dotsContainer.innerHTML = galleryImages.map((_, index) => 
                `<div class="w-3 h-3 rounded-full cursor-pointer transition-all ${index === 0 ? 'bg-orange-500' : 'bg-gray-300'}" 
                     onclick="goToSlide(${index})"></div>`
            ).join('');
            
            // FunciÃ³n para cambiar slide
            function updateSlide() {
                const slideElement = document.getElementById('gallery-slide');
                const currentImage = galleryImages[currentSlide];
                
                slideElement.innerHTML = `
                    <div class="text-center">
                        <div class="text-8xl mb-4">${currentImage.emoji}</div>
                        <p class="text-xl font-medium text-gray-600">${currentImage.text}</p>
                    </div>
                `;
                
                // Actualizar dots
                const dots = dotsContainer.children;
                for (let i = 0; i < dots.length; i++) {
                    dots[i].className = `w-3 h-3 rounded-full cursor-pointer transition-all ${
                        i === currentSlide ? 'bg-orange-500' : 'bg-gray-300'
                    }`;
                }
            }
            
            // FunciÃ³n global para cambiar slide manualmente
            window.goToSlide = function(index) {
                currentSlide = index;
                updateSlide();
            };
            
            updateSlide();
            
            // Auto-cambio cada 3 segundos
            galleryInterval = setInterval(() => {
                currentSlide = (currentSlide + 1) % galleryImages.length;
                updateSlide();
            }, 3000);
        }

        function stopImageGallery() {
            if (galleryInterval) {
                clearInterval(galleryInterval);
                galleryInterval = null;
            }
        }

        // Variables para administrador
        let isAdminLoggedIn = false;
        let currentEditType = '';
        let currentEditingBusiness = null;

        // Funciones de administrador
        function openAdminLogin() {
            document.getElementById('admin-login-modal').classList.remove('hidden');
            document.getElementById('admin-login-modal').classList.add('flex');
            document.getElementById('admin-password').focus();
        }

        function closeAdminLogin() {
            document.getElementById('admin-login-modal').classList.add('hidden');
            document.getElementById('admin-login-modal').classList.remove('flex');
            document.getElementById('admin-password').value = '';
        }

        function handleAdminLogin(e) {
            e.preventDefault();
            const password = document.getElementById('admin-password').value;
            
            if (password === '19752224') {
                isAdminLoggedIn = true;
                closeAdminLogin();
                openAdminPanel();
                showToast('âœ… Acceso concedido', 'success');
            } else {
                showToast('âŒ ContraseÃ±a incorrecta', 'error');
                document.getElementById('admin-password').value = '';
                document.getElementById('admin-password').focus();
            }
        }

        function openAdminPanel() {
            document.getElementById('admin-page').classList.remove('hidden');
            updateAdminStats();
        }

        function closeAdminPanel() {
            document.getElementById('admin-page').classList.add('hidden');
            isAdminLoggedIn = false;
        }

        function updateAdminStats() {
            document.getElementById('total-businesses').textContent = allBusinesses.length;
            document.getElementById('total-categories').textContent = categories.length;
            
            // Negocios recientes (Ãºltimos 7 dÃ­as)
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const recentCount = allBusinesses.filter(business => 
                new Date(business.fechaCreacion) > weekAgo
            ).length;
            document.getElementById('recent-businesses').textContent = recentCount;
        }

        function openEditContent(type) {
            currentEditType = type;
            const modal = document.getElementById('edit-content-modal');
            const title = document.getElementById('edit-content-title');
            const fields = document.getElementById('edit-content-fields');
            
            const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
            
            switch (type) {
                case 'company':
                    title.textContent = 'ğŸ¢ Editar InformaciÃ³n de Empresa';
                    fields.innerHTML = `
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #151a2b;">Nombre de la Empresa</label>
                            <input type="text" id="edit-company-name" value="${config.company_name || defaultConfig.company_name}" 
                                   class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2"
                                   style="border-color: #db3717; --tw-ring-color: #db3717;">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #151a2b;">Nombre de la Ciudad</label>
                            <input type="text" id="edit-city-name" value="${config.city_name || defaultConfig.city_name}" 
                                   class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2"
                                   style="border-color: #db3717; --tw-ring-color: #db3717;">
                        </div>
                    `;
                    break;
                case 'about':
                    title.textContent = 'ğŸ‘¥ Editar Contenido QuiÃ©nes Somos';
                    fields.innerHTML = `
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #151a2b;">Texto del BotÃ³n</label>
                            <input type="text" id="edit-about-text" value="${config.about_text || defaultConfig.about_text}" 
                                   class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2"
                                   style="border-color: #db3717; --tw-ring-color: #db3717;">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #151a2b;">Contenido del Modal</label>
                            <textarea id="edit-about-content" rows="4" 
                                      class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2"
                                      style="border-color: #db3717; --tw-ring-color: #db3717;"
                                      placeholder="Contenido que aparecerÃ¡ en el modal...">Somos una empresa dedicada a conectar negocios locales con la comunidad. Nuestro objetivo es promover el comercio local y facilitar que las personas descubran los mejores servicios de su ciudad.</textarea>
                        </div>
                    `;
                    break;
                case 'services':
                    title.textContent = 'ğŸ› ï¸ Editar Contenido Servicios';
                    fields.innerHTML = `
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #151a2b;">Texto del BotÃ³n</label>
                            <input type="text" id="edit-services-text" value="${config.services_text || defaultConfig.services_text}" 
                                   class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2"
                                   style="border-color: #db3717; --tw-ring-color: #db3717;">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #151a2b;">Contenido del Modal</label>
                            <textarea id="edit-services-content" rows="4" 
                                      class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2"
                                      style="border-color: #db3717; --tw-ring-color: #db3717;"
                                      placeholder="Contenido que aparecerÃ¡ en el modal...">Ofrecemos una plataforma completa para que los negocios locales puedan: â€¢ Publicar su informaciÃ³n de contacto â€¢ Mostrar sus servicios y productos â€¢ Conectar con clientes potenciales â€¢ Aumentar su visibilidad en la comunidad</textarea>
                        </div>
                    `;
                    break;
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeEditContent() {
            document.getElementById('edit-content-modal').classList.add('hidden');
            document.getElementById('edit-content-modal').classList.remove('flex');
            currentEditType = '';
        }

        async function handleEditContent(e) {
            e.preventDefault();
            
            if (!window.elementSdk) {
                showToast('âŒ Error: SDK no disponible', 'error');
                return;
            }
            
            let updateData = {};
            
            switch (currentEditType) {
                case 'company':
                    updateData = {
                        company_name: document.getElementById('edit-company-name').value.trim(),
                        city_name: document.getElementById('edit-city-name').value.trim()
                    };
                    break;
                case 'about':
                    updateData = {
                        about_text: document.getElementById('edit-about-text').value.trim()
                    };
                    // Actualizar contenido del modal (esto se guarda localmente)
                    localStorage.setItem('aboutContent', document.getElementById('edit-about-content').value.trim());
                    break;
                case 'services':
                    updateData = {
                        services_text: document.getElementById('edit-services-text').value.trim()
                    };
                    // Actualizar contenido del modal (esto se guarda localmente)
                    localStorage.setItem('servicesContent', document.getElementById('edit-services-content').value.trim());
                    break;
            }
            
            try {
                await window.elementSdk.setConfig(updateData);
                closeEditContent();
                showToast('âœ… Contenido actualizado exitosamente', 'success');
            } catch (error) {
                showToast('âŒ Error al actualizar contenido', 'error');
            }
        }

        // Funciones de gestiÃ³n de categorÃ­as
        function openCategoryManager() {
            document.getElementById('category-manager-modal').classList.remove('hidden');
            document.getElementById('category-manager-modal').classList.add('flex');
            renderCategoriesList();
        }

        function closeCategoryManager() {
            document.getElementById('category-manager-modal').classList.add('hidden');
            document.getElementById('category-manager-modal').classList.remove('flex');
            document.getElementById('add-category-form').reset();
        }

        function renderCategoriesList() {
            const list = document.getElementById('categories-list');
            list.innerHTML = categories.map((category, index) => `
                <div class="flex items-center justify-between p-3 bg-white rounded-lg border-2" style="border-color: ${category.color};">
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl">${category.icon}</span>
                        <span class="font-medium" style="color: ${category.color};">${category.name}</span>
                    </div>
                    <button onclick="deleteCategory(${index})" 
                            class="text-red-500 hover:text-red-700 px-3 py-1 rounded-lg hover:bg-red-50 transition-colors">
                        ğŸ—‘ï¸ Eliminar
                    </button>
                </div>
            `).join('');
        }

        function handleAddCategory(e) {
            e.preventDefault();
            
            const name = document.getElementById('new-category-name').value.trim();
            const icon = document.getElementById('new-category-icon').value.trim();
            
            if (!name || !icon) {
                showToast('âŒ Por favor completa todos los campos', 'error');
                return;
            }
            
            // Verificar si la categorÃ­a ya existe
            if (categories.some(cat => cat.name.toLowerCase() === name.toLowerCase())) {
                showToast('âŒ Esta categorÃ­a ya existe', 'error');
                return;
            }
            
            // Alternar colores para nuevas categorÃ­as
            const color = categories.length % 2 === 0 ? '#db3717' : '#151a2b';
            
            // Agregar nueva categorÃ­a
            categories.push({
                name: name,
                icon: icon,
                color: color
            });
            
            // Actualizar interfaz
            renderCategories();
            populateCategorySelect();
            renderCategoriesList();
            
            // Limpiar formulario
            document.getElementById('add-category-form').reset();
            
            showToast('âœ… CategorÃ­a agregada exitosamente', 'success');
        }

        function deleteCategory(index) {
            const category = categories[index];
            
            // Verificar si hay negocios usando esta categorÃ­a
            const businessesUsingCategory = allBusinesses.filter(business => business.categoria === category.name);
            
            if (businessesUsingCategory.length > 0) {
                showToast(`âŒ No se puede eliminar. Hay ${businessesUsingCategory.length} negocio(s) usando esta categorÃ­a`, 'error');
                return;
            }
            
            // Confirmar eliminaciÃ³n
            const confirmDelete = confirm(`Â¿EstÃ¡s seguro de eliminar la categorÃ­a "${category.name}"?`);
            if (!confirmDelete) return;
            
            // Eliminar categorÃ­a
            categories.splice(index, 1);
            
            // Actualizar interfaz
            renderCategories();
            populateCategorySelect();
            renderCategoriesList();
            
            showToast('âœ… CategorÃ­a eliminada exitosamente', 'success');
        }

        // Funciones de gestiÃ³n de negocios
        function openBusinessManager() {
            document.getElementById('business-manager-modal').classList.remove('hidden');
            document.getElementById('business-manager-modal').classList.add('flex');
            renderBusinessesList();
        }

        function closeBusinessManager() {
            document.getElementById('business-manager-modal').classList.add('hidden');
            document.getElementById('business-manager-modal').classList.remove('flex');
        }

        function renderBusinessesList() {
            const list = document.getElementById('admin-businesses-list');
            
            if (allBusinesses.length === 0) {
                list.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <div class="text-6xl mb-4">ğŸª</div>
                        <h3 class="text-xl font-bold mb-2" style="color: #151a2b;">No hay negocios</h3>
                        <p class="text-gray-600">AÃºn no se han agregado negocios al directorio.</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = allBusinesses.map(business => {
                const category = categories.find(c => c.name === business.categoria);
                return `
                    <div class="bg-white rounded-lg shadow-md p-4 border-l-4 hover:shadow-lg transition-shadow cursor-pointer" 
                         style="border-color: ${category ? category.color : '#db3717'};"
                         onclick="openBusinessEditor('${business.__backendId}')">
                        <div class="flex items-center space-x-3 mb-3">
                            <div class="w-12 h-12 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-gray-400 text-xs text-center">
                                ğŸ“·
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold text-lg" style="color: #151a2b;">${escapeHtml(business.nombre)}</h3>
                                <div class="flex items-center space-x-2">
                                    <span class="text-lg">${category ? category.icon : 'ğŸ“‹'}</span>
                                    <span class="text-sm text-gray-600">${escapeHtml(business.categoria)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <p class="text-gray-600 text-sm mb-3 line-clamp-2">
                            ${business.descripcion ? escapeHtml(business.descripcion) : 'Sin descripciÃ³n'}
                        </p>
                        
                        <div class="flex justify-between items-center text-xs text-gray-500">
                            <span>Creado: ${new Date(business.fechaCreacion).toLocaleDateString()}</span>
                            <span class="px-2 py-1 rounded-full text-white" style="background-color: ${category ? category.color : '#db3717'};">
                                âœï¸ Editar
                            </span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openBusinessEditor(businessId) {
            const business = allBusinesses.find(b => b.__backendId === businessId);
            if (!business) return;

            currentEditingBusiness = business;
            
            // Llenar formulario con datos actuales
            document.getElementById('edit-business-name').value = business.nombre || '';
            document.getElementById('edit-business-category').value = business.categoria || '';
            document.getElementById('edit-business-description').value = business.descripcion || '';
            document.getElementById('edit-business-website').value = business.sitioWeb || '';
            document.getElementById('edit-business-phone').value = business.telefono || '';
            document.getElementById('edit-business-whatsapp').value = business.whatsapp || '';
            document.getElementById('edit-business-email').value = business.email || '';
            document.getElementById('edit-business-instagram').value = business.instagram || '';
            document.getElementById('edit-business-address').value = business.direccion || '';
            
            // Poblar select de categorÃ­as
            const categorySelect = document.getElementById('edit-business-category');
            categorySelect.innerHTML = '<option value="">Seleccionar categorÃ­a</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.name;
                option.textContent = `${category.icon} ${category.name}`;
                if (category.name === business.categoria) {
                    option.selected = true;
                }
                categorySelect.appendChild(option);
            });
            
            // Actualizar tÃ­tulo
            document.getElementById('business-editor-title').textContent = `âœï¸ Editando: ${business.nombre}`;
            
            // Renderizar galerÃ­a de fotos
            renderBusinessPhotos();
            
            // Mostrar modal
            document.getElementById('business-editor-modal').classList.remove('hidden');
            document.getElementById('business-editor-modal').classList.add('flex');
        }

        function closeBusinessEditor() {
            document.getElementById('business-editor-modal').classList.add('hidden');
            document.getElementById('business-editor-modal').classList.remove('flex');
            currentEditingBusiness = null;
        }

        function renderBusinessPhotos() {
            const grid = document.getElementById('business-photos-grid');
            
            // Fotos de ejemplo (en una implementaciÃ³n real, estas vendrÃ­an de la base de datos)
            const samplePhotos = [
                { id: 1, emoji: 'ğŸª', title: 'Fachada' },
                { id: 2, emoji: 'ğŸ›ï¸', title: 'Interior' },
                { id: 3, emoji: 'ğŸ‘¥', title: 'Equipo' }
            ];
            
            grid.innerHTML = samplePhotos.map(photo => `
                <div class="relative group">
                    <div class="w-full h-24 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center text-gray-400 text-xs text-center">
                        <div class="text-2xl mb-1">${photo.emoji}</div>
                        <div>${photo.title}</div>
                    </div>
                    <button onclick="removePhoto(${photo.id})" 
                            class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full text-xs opacity-0 group-hover:opacity-100 transition-opacity">
                        âœ•
                    </button>
                </div>
            `).join('');
        }

        async function handleEditBusiness(e) {
            e.preventDefault();
            
            if (!currentEditingBusiness) return;

            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.innerHTML = '<div class="loading-spinner mx-auto"></div>';
            submitBtn.disabled = true;

            const updatedBusiness = {
                ...currentEditingBusiness,
                nombre: document.getElementById('edit-business-name').value.trim(),
                categoria: document.getElementById('edit-business-category').value,
                descripcion: document.getElementById('edit-business-description').value.trim(),
                sitioWeb: document.getElementById('edit-business-website').value.trim()
            };

            const result = await window.dataSdk.update(updatedBusiness);
            
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;

            if (result.isOk) {
                showToast('âœ… InformaciÃ³n bÃ¡sica actualizada', 'success');
                renderBusinessesList(); // Actualizar lista
            } else {
                showToast('âŒ Error al actualizar la informaciÃ³n', 'error');
            }
        }

        async function handleSaveContact() {
            if (!currentEditingBusiness) return;

            const saveBtn = document.getElementById('save-contact-btn');
            const originalText = saveBtn.textContent;
            saveBtn.innerHTML = '<div class="loading-spinner mx-auto"></div>';
            saveBtn.disabled = true;

            const updatedBusiness = {
                ...currentEditingBusiness,
                telefono: document.getElementById('edit-business-phone').value.trim(),
                whatsapp: document.getElementById('edit-business-whatsapp').value.trim(),
                email: document.getElementById('edit-business-email').value.trim(),
                instagram: document.getElementById('edit-business-instagram').value.trim(),
                direccion: document.getElementById('edit-business-address').value.trim()
            };

            const result = await window.dataSdk.update(updatedBusiness);
            
            saveBtn.textContent = originalText;
            saveBtn.disabled = false;

            if (result.isOk) {
                showToast('âœ… InformaciÃ³n de contacto actualizada', 'success');
                currentEditingBusiness = updatedBusiness; // Actualizar referencia local
            } else {
                showToast('âŒ Error al actualizar informaciÃ³n de contacto', 'error');
            }
        }

        async function handleDeleteBusiness() {
            if (!currentEditingBusiness) return;

            // ConfirmaciÃ³n inline
            const deleteBtn = document.getElementById('delete-business-btn');
            const originalText = deleteBtn.textContent;
            
            if (deleteBtn.textContent === originalText) {
                deleteBtn.textContent = 'âš ï¸ Â¿Confirmar EliminaciÃ³n?';
                deleteBtn.style.backgroundColor = '#dc2626';
                
                setTimeout(() => {
                    if (deleteBtn.textContent !== originalText) {
                        deleteBtn.textContent = originalText;
                        deleteBtn.style.backgroundColor = '#dc2626';
                    }
                }, 3000);
                return;
            }

            deleteBtn.innerHTML = '<div class="loading-spinner mx-auto"></div>';
            deleteBtn.disabled = true;

            const result = await window.dataSdk.delete(currentEditingBusiness);
            
            if (result.isOk) {
                showToast('âœ… Negocio eliminado exitosamente', 'success');
                closeBusinessEditor();
                renderBusinessesList();
            } else {
                showToast('âŒ Error al eliminar el negocio', 'error');
                deleteBtn.textContent = originalText;
                deleteBtn.disabled = false;
            }
        }

        function removePhoto(photoId) {
            showToast(`ğŸ“¸ Foto ${photoId} eliminada`, 'success');
            renderBusinessPhotos();
        }

        function uploadLogo() {
            showToast('ğŸ“¤ FunciÃ³n de subida de logo simulada', 'info');
        }

        function removeLogo() {
            showToast('ğŸ—‘ï¸ Logo eliminado', 'success');
        }

        function addPhoto() {
            showToast('ğŸ“¸ FunciÃ³n de agregar foto simulada', 'info');
            // Simular agregar una nueva foto
            renderBusinessPhotos();
        }

        // Hacer funciones globales para poder usarlas desde onclick
        window.deleteCategory = deleteCategory;
        window.openBusinessEditor = openBusinessEditor;
        window.removePhoto = removePhoto;
        window.uploadLogo = uploadLogo;
        window.removeLogo = removeLogo;
        window.addPhoto = addPhoto;

        // Inicializar aplicaciÃ³n
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'990a7d534096b356',t:'MTc2MDgxNjIzOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
